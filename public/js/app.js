// Generated by CoffeeScript 1.9.3
(function() {
  window.sechzig || (window.sechzig = {});

  sechzig.backing = {
    initialize: function() {}
  };

  $(function() {
    return sechzig.backing.initialize();
  });

  sechzig.blocking = {
    initialize: function() {
      var movement;
      return this.movements = [
        movement = {
          'section': 'scene-one',
          'character': ".thing",
          'startTime': 0.5,
          'finishTime': 1,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 1,
            'opacity': 1
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 250,
            'rotate': 0,
            'opacity': -1
          }
        }, movement = {
          'section': 'scene-one',
          'character': ".thang",
          'startTime': 0.5,
          'finishTime': 1,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 1,
            'opacity': 1
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 150,
            'rotate': 0,
            'opacity': -1
          }
        }, movement = {
          'section': 'scene-one',
          'character': ".theng",
          'startTime': 0.5,
          'finishTime': 1,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 1,
            'opacity': 1
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 50,
            'rotate': 0,
            'opacity': -1
          }
        }, movement = {
          'section': 'scene-two',
          'character': ".thong",
          'startTime': 0.5,
          'finishTime': 0.75,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 1,
            'opacity': 1
          },
          'finishValues': {
            'translateX': -50,
            'translateY': 0,
            'rotate': 0,
            'opacity': -1
          }
        }, movement = {
          'section': 'scene-two',
          'character': ".theng",
          'startTime': 0.5,
          'finishTime': 0.75,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 1,
            'opacity': 1
          },
          'finishValues': {
            'translateX': 0,
            'translateY': -50,
            'rotate': 0,
            'opacity': -1
          }
        }, movement = {
          'section': 'scene-three',
          'character': ".thing",
          'startTime': 0,
          'finishTime': 0.333333,
          'startValues': {
            'translateX': 0,
            'translateY': -50,
            'rotate': 0,
            'scale': 0,
            'opacity': 0
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 50,
            'rotate': 0,
            'opacity': 1
          }
        }, movement = {
          'section': 'scene-six',
          'character': ".thing",
          'startTime': 0,
          'finishTime': 0.25,
          'startValues': {
            'translateX': 0,
            'translateY': -50,
            'rotate': 0,
            'scale': 0,
            'opacity': 0
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 50,
            'rotate': 0,
            'opacity': 1
          }
        }, movement = {
          'section': 'scene-six',
          'character': ".thang",
          'startTime': 0,
          'finishTime': 0.25,
          'startValues': {
            'translateX': 0,
            'translateY': -150,
            'rotate': 0,
            'scale': 0,
            'opacity': 0
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 150,
            'rotate': 0,
            'opacity': 1
          }
        }, movement = {
          'section': 'scene-six',
          'character': ".theng",
          'startTime': 0,
          'finishTime': 0.25,
          'startValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'scale': 0,
            'opacity': 0
          },
          'finishValues': {
            'translateX': 0,
            'translateY': 0,
            'rotate': 0,
            'opacity': 1
          }
        }
      ];
    },
    assignMovements: function(section) {
      var i, len, movement, ref, sectionMovements;
      sectionMovements = [];
      ref = sechzig.blocking.movements;
      for (i = 0, len = ref.length; i < len; i++) {
        movement = ref[i];
        if (movement.section === section) {
          sectionMovements.push(movement);
        }
      }
      return sectionMovements;
    }
  };

  $(function() {
    return sechzig.blocking.initialize();
  });

  sechzig.raf = {
    callbacks: [],
    initialize: function() {
      return this.rafBreak = false;
    },
    rafBreakCheck: function() {
      if (this.rafBreak === false) {
        requestAnimationFrame(function() {
          $.each(sechzig.raf.callbacks, function() {
            return this.call();
          });
          return sechzig.raf.rafBreak = false;
        });
        return sechzig.raf.rafBreak = true;
      }
    },
    onScroll: function(callback) {
      return this.callbacks.push(callback);
    }
  };

  $(function() {
    return sechzig.raf.initialize();
  });

  sechzig.resize = {
    callbacks: [],
    initialize: function() {
      return this.enableBindings();
    },
    enableBindings: function() {
      return $(window).on('resize', function() {
        return sechzig.resize.recalcLayout();
      });
    },
    recalcLayout: function() {
      return $.each(this.callbacks, function() {
        return this.call();
      });
    },
    onResize: function(callback) {
      return this.callbacks.push(callback);
    }
  };

  $(function() {
    return sechzig.resize.initialize();
  });

  sechzig.scroll = {
    initialize: function() {
      this.scrollTop = 0;
      this.scrollHeight = $(window).height();
      this.scrollBottom = this.scrollHeight;
      this.enableBindings();
      return sechzig.resize.onResize(sechzig.scroll.updateScroll);
    },
    enableBindings: function() {
      return $(window).on('scroll', function() {
        sechzig.scroll.scrollTop = $(window).scrollTop();
        sechzig.scroll.scrollBottom = sechzig.scroll.scrollTop + sechzig.scroll.scrollHeight;
        return sechzig.raf.rafBreakCheck();
      });
    },
    updateScroll: function() {
      sechzig.scroll.scrollTop = $(window).scrollTop();
      sechzig.scroll.scrollHeight = $(window).height();
      sechzig.scroll.scrollBottom = sechzig.scroll.scrollTop + sechzig.scroll.scrollHeight;
      sechzig.stage.arrangeScenes();
      return sechzig.stage.monitorScenes();
    }
  };

  $(function() {
    return sechzig.scroll.initialize();
  });

  sechzig.stage = {
    initialize: function() {
      this.arrangeScenes();
      this.monitorScenes();
      return sechzig.raf.onScroll(sechzig.stage.monitorScenes);
    },
    arrangeScenes: function() {
      this.scenes = [];
      return $('.scene').each(function() {
        var $this, scenesHash;
        $this = $(this);
        scenesHash = {
          id: $this.attr('id'),
          top: $this.offset().top,
          bottom: $this.offset().top + $this.height(),
          height: $this.height(),
          object: $this,
          duration: $this.height() + sechzig.scroll.scrollHeight,
          sceneIsActive: false,
          progress: 0,
          blocking: sechzig.blocking.assignMovements(this.id),
          sticky: $this.data('sticky') || false
        };
        return sechzig.stage.scenes.push(scenesHash);
      });
    },
    monitorScenes: function() {
      var i, len, ref, results, scene;
      ref = sechzig.stage.scenes;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        scene = ref[i];
        if (sechzig.stage.sceneIsActive(scene)) {
          scene.sceneIsActive = true;
          results.push(sechzig.stage.directActiveScenes(scene));
        } else {
          results.push(scene.sceneIsActive = false);
        }
      }
      return results;
    },
    sceneIsActive: function(scene) {
      return (sechzig.scroll.scrollTop >= scene.top && sechzig.scroll.scrollTop <= scene.bottom) || (sechzig.scroll.scrollBottom >= scene.top && sechzig.scroll.scrollBottom <= scene.bottom);
    },
    directActiveScenes: function(scene) {
      sechzig.stage.getSceneProgress(scene);
      sechzig.stage.getBlockingProgress(scene);
      if (scene.sticky !== false) {
        return sechzig.stage.setStickyScene(scene);
      }
    },
    getSceneProgress: function(scene) {
      return scene.progress = Math.max(Math.min((sechzig.scroll.scrollBottom - scene.top) / scene.duration, 1), 0);
    },
    getBlockingProgress: function(scene) {
      var i, len, movement, ref, results;
      ref = scene.blocking;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        movement = ref[i];
        movement.startPixel = (movement.startTime * scene.duration) + scene.top;
        movement.finishPixel = (movement.finishTime * scene.duration) + scene.top;
        movement.totalPixels = movement.finishPixel - movement.startPixel;
        movement.progress = (sechzig.scroll.scrollBottom - movement.startPixel) / movement.totalPixels;
        if (movement.progress >= 0 && movement.progress <= 1) {
          results.push(sechzig.stage.animateMovement(scene, movement));
        } else {
          results.push(void 0);
        }
      }
      return results;
    },
    animateMovement: function(scene, movement) {
      return $("#" + scene.id + " " + movement.character).css({
        'opacity': movement.finishValues.opacity * movement.progress + movement.startValues.opacity,
        'transform': "translate3d( " + (movement.finishValues.translateX * movement.progress + movement.startValues.translateX) + "vw, " + (movement.finishValues.translateY * movement.progress + movement.startValues.translateY) + "vh, 0) rotate( " + (movement.finishValues.rotate * movement.progress + movement.startValues.rotate) + "deg)"
      });
    },
    setStickyScene: function(scene) {
      this.blocking = scene.object.find('.blocking');
      switch (scene.sticky) {
        case "top":
          if (scene.top <= sechzig.scroll.scrollTop && scene.bottom >= sechzig.scroll.scrollBottom) {
            this.blocking.css({
              'position': 'fixed',
              'top': 0,
              'bottom': 'auto'
            });
          }
          if (scene.top >= sechzig.scroll.scrollTop) {
            this.blocking.css({
              'position': 'static'
            });
          }
          if (scene.bottom <= sechzig.scroll.scrollBottom) {
            return this.blocking.css({
              'position': 'absolute',
              'bottom': 0,
              'top': 'auto'
            });
          }
          break;
        case "bottom":
          if (scene.top <= sechzig.scroll.scrollBottom) {
            return scene.object.find('.blocking').css({
              'position': 'fixed',
              'bottom': 0
            });
          } else {
            return scene.object.find('.blocking').css({
              'position': 'static'
            });
          }
      }
    }
  };

  $(function() {
    return sechzig.stage.initialize();
  });

}).call(this);
